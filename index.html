<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI聊天助手 - DeepSeek V3</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary-color: #10a37f;
            --bg-color: #f7f7f8;
            --sidebar-bg: #202123;
            --message-ai-bg: #f7f7f8;
            --message-user-bg: #ffffff;
            --text-color: #343541;
            --text-light: #8e8ea0;
            --border-color: #e5e5e6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
        }

        /* 免责协议弹窗 */
        .disclaimer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .disclaimer-content {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 极速0.2);
        }

        .disclaimer-content h2 {
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        .disclaimer-content p {
            margin-bottom: 16px;
            line-height: 1.6;
            font-size: 14px;
            color: var(--text-color);
        }

        .disclaimer-content ul {
            margin-left: 20px;
            margin-bottom: 16px;
        }

        .极速disclaimer-content li {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .disclaimer-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .agree-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10极速px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .agree-btn:hover {
            background-color: #0d8c6d;
        }

        /* 移动端侧边栏隐藏 */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            color: white;
            padding: 16px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .logo svg {
            width: 32px;
            height: 32px;
        }

        .new-chat-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: white;
            text-align: left;
            cursor: pointer;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .new-chat-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .history-list {
            flex-grow: 1;
            overflow-y: auto;
        }

        .history-item {
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:hover {
            background-color: rgba(255, 255, 255, 0.极速1);
        }

        .delete-ch极速at {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            display: none;
        }

        .history-item:hover .delete-chat {
            display: block;
        }

        .delete-chat:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            max-height: 100vh;
            width: 100%;
        }

        .chat-header {
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            background-color: white;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
        }

        .model-selector {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: white;
            font-size: 14px;
            cursor: pointer;
            min-width: 160px;
        }

        .language-selector {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: white;
            font-size: 14px;
            cursor: pointer;
            min-width: 120px;
        }

        .chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .message {
            display: flex;
            gap: 24px;
            padding: 24px 0;
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
        }

        /* 调整消息宽度 */
        @media (min-width: 1200px) {
            .message {
                max-width: 900px;
            }
        }

        @media (min-width: 768px) and (max-width: 1199px) {
            .message {
                max-width: 85%;
            }
        }

        @media (max-width: 767px) {
            .message {
                max-width: 95%;
                gap: 12px;
                padding: 16px 0;
            }
            
            .header-controls {
                flex-direction: column;
                align-items: flex-end;
                gap: 8px;
            }
            
            .model-selector, .language-selector {
                min-width: 110px;
                font-size: 13px;
                padding: 6px 10px;
            }
        }

        .message-ai {
            background-color: var(--message-ai-bg);
        }

        .message-user {
            background-color: var(--message-user-bg);
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 4px;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .avatar-user {
            background-color: #ab68ff;
        }

        .message-content {
            flex-grow: 1;
            line-height: 1.5;
            padding-top: 6px;
        }

        .message-content pre {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .message-content code {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .message-content table {
            border-collapse: collapse;
            width: 极速100%;
            margin: 12px 0;
        }

        .message-content th, .message-content td {
            border: 1px solid #ddd;
            padding: 8px;
极速        }

        .message-content th {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .input-area {
            padding: 24px;
            display: flex;
            justify-content: center;
            position: sticky;
            bottom: 0;
            background: linear-gradient(transparent, var(--bg-color) 20%);
        }

        .input-container {
            max-width: 800px;
            width: 100%;
            position: relative;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .input-field {
            width: 100%;
            padding: 14px 48px 14px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            resize: none;
            height: 56px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            font-size: 16px;
        }

        .send-btn {
            position: absolute;
            right: 12px;
            bottom: 12px;
            background: transparent;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 4px;
            border-radius: 4极速px;
        }

        .send-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .send-btn:disabled {
            color: var(--text-light);
            cursor: not-allowed;
        }

        .disclaimer-footer {
            text-align: center;
            padding: 16px;
            font-size: 12px;
            color: var(--text-light);
            border-top: 1px solid var(--border-color);
        }

        /* 移动端响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .menu-toggle {
                display: block;
            }
            
            .message {
                gap: 12px;
                padding: 16px 0;
            }
            
            .chat-container {
                padding: 16px;
            }
            
            .input-area {
                padding: 16px;
            }
            
            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }
            
            .overlay.active {
                display: block;
            }
            
            .disclaimer-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    
    <!-- 免责协议弹窗 -->
    <div class="disclaimer-modal" id="disclaimerModal">
        <div class="disclaimer-content">
            <h2 id="disclaimerTitle">免责声明</h2>
            <p id="disclaimerText1">在使用本AI聊天助手前，请仔细阅读以下免责声明：</p>
            
            <ul>
                <li id="disclaimerItem1">本AI助手生成的内容可能包含不准确或错误的信息，请谨慎参考</li>
                <li id="disclaimerItem2">AI生成的内容不代表开发者的观点或立场</li>
                <极速li id="disclaimerItem3">请勿输入个人敏感信息，对话内容可能会被用于模型训练</li>
                <li id="disclaimerItem4">对于用户基于AI生成内容做出的任何决策，开发者不承担任何责任</li>
                <li id="disclaimerItem5">开发者保留随时修改或终止服务的权利</li>
            </ul>
            
            <p id="disclaimerText2">继续使用本服务表示您已阅读、理解并同意以上免责声明。</p>
            
            <div class="disclaimer-actions">
                <button class="agree-btn" id="agreeBtn">同意并继续</button>
            </div>
        </div>
    </div>
    
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 4H4C2.89543 4 2 4.89543 2 6V18C2 19.1046 2.89543 20 4 20极速H20C21.104极速6 20 22 19.1046 22 18V6C22 4.89543 21.1046 4 20 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M22 7L13.03 12.7C12.7213 12.8934 12.3643 12.9978 12 12.9978C11.6357 12.9978 11.2787 12.8934 10.97 12.7L2 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span id="appName">AI聊天助手</span>
        </div>
        
        <button class="new-chat-btn" id="newChatBtn">
            <i class="fas fa-plus"></i>
            <span id="newChatText">新建聊天</span>
        </button>
        
        <div class="history-list" id="historyList">
            <!-- 聊天历史将通过JS动态生成 -->
        </div>
    </aside>
    
    <main class="main">
        <header class极速="chat-header">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-controls">
                <select class="model-selector" id="modelSelector">
                    <option value="deepseek-v3">DeepSeek V3</option>
                    <option value="deepseek-coder">DeepSeek Coder</option>
                    <option value="deepseek-chat">DeepSeek Chat</option>
                </select>
                <select class="language-selector" id="languageSelector">
                    <option value="zh-CN">中文 (简体)</option>
                    <option value="zh-TW">中文 (繁体)</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="ru">Русский</option>
                </select>
            </div>
        </header>
        
        <div class="chat-container" id="chatContainer">
            <div class="message message-ai">
                <div class="avatar">AI</div>
                <div class="message-content" id="welcomeMessage">
                    您好！我是DeepSeek V3 AI助手，有什么我可以帮助您的吗？
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <div class="input-container">
                <textarea class="input-field" id="inputField" placeholder="输入您的问题..." rows="1"></textarea>
                <button class="send-btn" id="sendBtn" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <div class="disclaimer-footer" id="disclaimerFooter">
            AI可能会生成不准确或错误的信息，请谨慎参考
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 元素引用
            const disclaimerModal = document.getElementById('disclaimerModal');
            const agreeBtn = document.getElementById('agreeBtn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const menuToggle = document.getElementById('menuToggle');
            const newChatBtn = document.getElementById('newChatBtn');
            const historyList = document.getElementById('historyList');
            const chatContainer = document.getElementById('chatContainer');
            const inputField = document.getElementById('inputField');
            const sendBtn = document.getElementById('sendBtn');
            const modelSelector = document.getElementById('modelSelector');
            const languageSelector = document.getElementById('languageSelector');
            
            // 多语言支持
            const translations = {
                'zh-CN': {
                    appName: 'AI聊天助手',
                    newChat: '新建聊天',
                    welcome: '您好！我是DeepSeek V3 AI助手，有什么我可以帮助您的吗？',
                    inputPlaceholder: '输入您的问题...',
                    disclaimerTitle: '免责声明',
                    disclaimerText1: '在使用本AI聊天助手前，请仔细阅读以下免责声明：',
                    disclaimerItem1: '本AI助手生成的内容可能包含不准确或错误的信息，请谨慎参考',
                    disclaimerItem2: 'AI生成的内容不代表开发者的观点或立场',
                    disclaimerItem3: '请极速勿输入个人敏感信息，对话内容可能会被用于模型训练',
                    disclaimerItem4: '对于用户基于AI生成内容做出的任何决策，开发者不承担任何责任',
                    disclaimerItem5: '开发者保留随时修改或终止服务的权利',
                    disclaimerText2: '继续使用本服务表示您极速已阅读、理解并同意以上免责声明。',
                    agree: '同意并继续',
                    footer: 'AI可能会生成不准确或错误的信息，请谨慎参考'
                },
                'zh-TW': {
                    appName: 'AI聊天助手',
                    newChat: '新建聊天',
                    welcome: '您好！我是DeepSeek V3 AI助手，有什麼我可以幫助您的嗎？',
                    inputPlaceholder: '輸入您的問題...',
                    disclaimerTitle: '免責聲明',
                    disclaimerText1: '在使用本AI聊天助手前，請仔細閱讀以下免責聲明：',
                    disclaimerItem1: '本AI助手生成的內容可能包含不準確或錯誤的資訊，請謹慎參考',
                    disclaimerItem2: 'AI生成的內容不代表開發者的觀點或立場',
                    disclaimerItem3: '請勿輸入個人敏感資訊，對話內容可能會被用於模型訓練',
                    disclaimerItem4: '對於用戶基於AI生成內容做出的任何決策，開發者不承擔任何責任',
                    disclaimerItem5: '開發者保留隨時修改或終止服務的權利',
                    disclaimerText2: '繼續使用本服務表示您已閱讀、理解並同意以上免責聲明。',
                    agree: '同意並繼續',
                    footer: 'AI可能會生成不準確或錯誤的資訊，請謹慎參考'
                },
                'en': {
                    appName: 'AI Chat Assistant',
                    newChat: 'New Chat',
                    welcome: 'Hello! I am DeepSeek V3 AI assistant, how can I help you today?',
                    inputPlaceholder: 'Type your question...',
                    disclaimerTitle: 'Disclaimer',
                    disclaimerText1: 'Before using this AI chat assistant, please read the following disclaimer carefully:',
                    disclaimerItem1: 'The content generated by this AI assistant may contain inaccuracies or errors, please use with caution',
                    disclaimerItem2: 'AI-generated content does not represent the views or立场 of the developers',
                    disclaimerItem3: 'Do not enter personal sensitive information, conversation content may be used for model training',
                    disclaimerItem4: 'The developer is not responsible for any decisions made by users based on AI-generated content',
                    disclaimerItem5: 'The developer reserves the right to modify or terminate the service at any time',
                    disclaimerText2: 'By continuing to use this service, you indicate that you have read, understood, and agree to the above disclaimer.',
                    agree: 'Agree and Continue',
                    footer: 'AI may generate inaccurate or erroneous information, please use with caution'
                },
                'ja': {
                    appName: 'AIチャットアシスタント',
                    newChat: '新しいチャット',
                    welcome: 'こんにちは！DeepSeek V3 AIアシスタントです。何かお手伝いできることはありますか？',
                    inputPlaceholder: '質問を入力してください...',
                    disclaimerTitle: '免責事項',
                    disclaimerText1: 'このAIチャットアシスタントを使用する前に、以下の免責事項をよくお読みください：',
                    disclaimerItem1: 'このAIアシスタントが生成するコンテンツには不正確または誤った情報が含まれている可能性がありますので、注意してご利用ください',
                    disclaimerItem2: 'AIが生成するコンテンツは開発者の見解または立場を代表するものではありません',
                    disclaimerItem3: '個人の機密情報を入力しないでください。会話内容はモデルトレーニングに使用される場合があります',
                    disclaimerItem4: 'AI生成コンテンツに基づくユーザーのいかなる決定についても、開発者は一切の責任を負いません',
                    disclaimerItem5极速: '開発者はいつでもサービスを変更または終了する権利を留保します',
                    disclaimerText2: '本サービスを継続して使用することにより、上記の免責事項を読み、理解し、同意したものとみなされます。',
                    agree: '同意して続行',
                    footer: 'AIは不正確または誤った情報を生成する可能性がありますので、注意してご利用ください'
                },
                'ru': {
                    appName: 'AI Чат-помощник',
                    newChat: 'Новый чат',
                    welcome: 'Здравствуйте! Я DeepSeek V3 AI-помощник, чем могу вам помочь?',
                    inputPlaceholder: 'Введите ваш вопрос...',
                    disclaimerTitle: 'Отказ от ответственности',
                    disclaimerText1: 'Перед использованием этого AI чат-помощника, пожалуйста, внимательно прочтите следующее:',
                    disclaimerItem1: 'Содержание, созданное этим AI-помощником, может содержать неточности или ошибки, используйте с осторожностью',
                    disclaimerItem2: 'Сгенерированный AI контент не представляет взгляды или позицию разработчиков',
                    disclaimerItem3: 'Не вводите личную конфиденциальную информацию, содержимое разговора может быть использовано для обучения моделей',
                    disclaimerItem4: 'Разработчик не несет ответственности за любые решения, принятые пользователями на основе контента, созданного AI',
                    disclaimerItem5: 'Разработчик оставляет за собой право изменять или прекращать обслуживание в любое время',
                    disclaimerText2: 'Продолжая использовать этот сервис, вы подтверждаете, что прочитали, поняли и согласны с приведенным выше отказом от ответственности.',
                    agree: 'Согласен и Продолжить',
                    footer: 'AI может генерировать неточную или ошибочную информацию, используйте с осторожностью'
                }
            };
            
            // 聊天数据管理
            let chats = JSON.parse(localStorage.getItem('aiChats')) || {};
            let currentChatId = null;
            
            // 检查是否已同意免责协议
            const agreedToDisclaimer = localStorage.getItem('agreedToDisclaimer');
            
            // 获取用户语言设置
            let userLanguage = localStorage.getItem('userLanguage') || navigator.language || 'zh-CN';
            
            // 初始化
            function init() {
                // 设置语言选择器
                languageSelector.value = userLanguage;
                applyLanguage(userLanguage);
                
                // 显示免责协议（如果用户尚未同意）
                if (!agreedToDisclaimer) {
                    disclaimerModal.style.display = 'flex';
                }
                
                // 加载聊天历史
                renderChatHistory();
                
                // 如果没有聊天，创建一个默认聊天
                if (Object.keys(chats).length === 0) {
                    createNewChat();
                } else {
                    // 加载最后一个聊天
                    const lastChatId = Object.keys(chats).pop();
                    loadChat(lastChatId);
                }
                
                // 移动端侧边栏控制
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('active');
                }
            }
            
            // 应用语言设置
            function applyLanguage(lang) {
                const langData = translations[lang] || translations['zh-CN'];
                
                // 更新界面文本
                document.getElementById('appName').textContent = langData.appName;
                document.getElementById('newChatText').textContent = langData.newChat;
                document.getElementById('welcomeMessage').textContent = langData.welcome;
                document.getElementById('disclaimerTitle').textContent = langData.disclaimerTitle;
                document.getElementById('disclaimerText1').textContent = langData.disclaimerText1;
                document.getElementById('disclaimerItem1').textContent = langData.disclaimerItem1;
                document.getElementById('disclaimerItem2').textContent = langData.disclaimerItem2;
                document.getElementById('disclaimerItem3').textContent = langData.disclaimerItem3;
                document.getElementById('disclaimerItem4').textContent = lang极速Data.disclaimerItem4;
                document.getElementById('disclaimerItem5').textContent = langData.disclaimerItem5;
                document.getElementById('disclaimerText2').textContent = langData.disclaimerText2;
                document.getElementById('agreeBtn').textContent = langData.agree;
                document.getElementById('disclaimerFooter').textContent = langData.footer;
                inputField.placeholder = langData.inputPlaceholder;
                
                // 保存语言设置
                localStorage.setItem('userLanguage', lang);
                userLanguage = lang;
            }
            
            // 同意免责协议
            agreeBtn.addEventListener('click', function() {
                disclaimerModal.style.display = 'none';
                localStorage.setItem('agreedToDisclaimer', 'true');
            });
            
            // 语言选择器事件
            languageSelector.addEventListener('change', function() {
                applyLanguage(this.value);
            });
            
            // 创建新聊天
            function createNewChat() {
                const chatId = 'chat_' + Date.now();
                currentChat极速Id = chatId;
                
                chats[chatId] = {
                    id: chatId,
                    title: translations[userLanguage].newChat,
                    messages: [
                        {
                            role: 'ai',
                            content: translations[userLanguage].welcome
                        }
                    ],
                    createdAt: new Date().toISOString(),
                    model: modelSelector.value
                };
                
                saveChats();
                renderChatHistory();
                renderChatMessages();
                
                // 清空输入框
                inputField.value = '';
                adjustTextareaHeight();
            }
            
            // 加载聊天
            function loadChat(chatId) {
                currentChatId = chatId;
                renderChatMessages();
                
                // 更新模型选择器
                modelSelector.value = chats[chatId].model;
            }
            
            // 删除聊天
            function deleteChat(chatId, event) {
                event.stopPropagation();
                
                if (Object.keys(chats).length <= 1) {
                    alert(translations[userLanguage].disclaimerItem1);
                    return;
                }
                
                if (confirm(translations[userLanguage].disclaimerItem1)) {
                    delete chats[chatId];
                    saveChats();
                    
                    // 如果删除的是当前聊天，加载另一个聊天
                    if (currentChatId === chatId) {
                        const remainingChatIds = Object.keys(chats);
                        if (remainingChatIds.length > 0) {
                            loadChat(remainingChatIds[0]);
                        } else {
                            createNewChat();
                        }
                    }
                    
                    renderChatHistory();
                }
            }
            
            // 保存聊天到本地存储
            function saveChats() {
                localStorage.setItem('aiChats', JSON.stringify(chats));
            }
            
            // 渲染聊天历史列表
            function renderChatHistory() {
                historyList.innerHTML = '';
                
                Object.values(chats).sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt)).forEach(chat => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    if (chat.id === currentChatId) {
                        historyItem.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                    }
                    
                    historyItem.innerHTML = `
                        <span>${chat.title}</span>
                        <button class="delete-chat">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    historyItem.addEventListener('click', () => {
                        loadChat(chat.id);
                        // 在移动端关闭侧边栏
                        if (window.innerWidth <= 768) {
                            sidebar.classList.remove('active');
                            overlay.classList.remove('active');
                        }
                    });
                    
                    const deleteBtn = historyItem.querySelector('.delete-chat');
                    deleteBtn.addEventListener('click', (e) => deleteChat(chat.id, e));
                    
                    historyList.appendChild(historyItem);
                });
            }
            
            // 渲染聊天消息
            function renderChatMessages() {
                chatContainer.innerHTML = '';
                
                if (currentChatId && chats[currentChatId]) {
                    chats[currentChatId].messages.forEach(message => {
                        const messageEl = document.createElement('div');
                        messageEl.className = `message message-${message.role}`;
                        
                        messageEl.innerHTML = `
                            <div class="avatar ${message.role === 'user' ? 'avatar-user' : ''}">
                                ${message.role === 'user' ? (userLanguage === 'zh-CN' || userLanguage === 'zh-TW' ? '您' : 'You') : 'AI'}
                            </div>
                            <div class="message-content">
                                ${marked.parse(message.content)}
                            </div>
                        `;
                        
                        chatContainer.appendChild(messageEl);
                    });
                }
                
                // 滚动到底部
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // 发送消息
            function sendMessage() {
                const message = inputField.value.trim();
                if (!message) return;
                
                // 添加用户消息
                chats[currentChatId].messages.push({
                    role: 'user',
                    content: message
                });
                
                // 更新聊天标题（如果是第一条用户消息）
                if (chats[currentChatId].messages.filter(m => m.role === 'user').length === 1) {
                    chats[currentChatId].title = message.length > 20 ? message.substring(0, 20) + '...' : message;
                }
                
               极速 // 清空输入框
                inputField.value = '';
                adjustTextareaHeight();
                
                // 保存并渲染
                saveChats();
                renderChatHistory();
                renderChatMessages();
                
                // 禁用发送按钮
                sendBtn.disabled = true;
                
                // 模拟AI响应
                simulateAIResponse(message);
            }
            
            // 模拟AI响应
            function simulateAIResponse(userMessage) {
                setTimeout(() => {
                    // 简单的响应逻辑
                    let response = translations[userLanguage].welcome;
                    
                    // 添加AI消息
                    chats[currentChatId].messages.push({
                        role: 'ai',
                        content: response
                    });
                    
                    // 保存并渲染
                    saveChats();
                    renderChatMessages();
                    
                    // 启用发送按钮
                    sendBtn.disabled = false;
                }, 1000);
            }
            
            // 调整文本区域高度
            function adjustTextareaHeight() {
                inputField.style.height = 'auto';
                inputField.style.height = (inputField.scrollHeight) + 'px';
                
                // 启用或禁用发送按钮
                sendBtn.disabled = !inputField.value.trim();
            }
            
            // 事件监听
            newChatBtn.addEventListener('click', createNewChat);
            
            sendBtn.addEventListener('click', sendMessage);
            
            inputField.addEventListener('input', adjustTextareaHeight);
            
            inputField.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            modelSelector.addEventListener('change', () => {
                if (currentChatId) {
                    chats[currentChatId].model = modelSelector.value;
                    saveChats();
                }
            });
            
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            });
            
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
            
            // 初始化应用
            init();
        });
    </script>
</body>
</html>
